---
import type { GetStaticPaths } from "astro";
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import InteriorPage from "../../components/InteriorPage.astro";
import { GALLERY_PAGE_SIZE, SITE_SEO } from "../../config/site";
import Pagination from "../../components/articles/Pagination.astro";
import PhotoGallery from "../../components/PhotoGallery.astro";

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const photoGallery = await getCollection("gallery");
  const sortedImages = photoGallery.sort(
    (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  return paginate(sortedImages, { pageSize: GALLERY_PAGE_SIZE });
};

const { page } = Astro.props as {
  page: {
    data: CollectionEntry<"gallery">[];
    currentPage: number;
    lastPage: number;
    url: {
      prev?: string | null;
      next?: string | null;
    };
  };
};
const posts = page.data;
const pageDesc = `Explore our photo gallery showcasing the spirit and dedication of our students and instructors in Okinawan martial arts.`;
---

<Layout title={`Photo Gallery | ${SITE_SEO.name.long}`} description={pageDesc}>
  <InteriorPage heading="Photo Gallery" lead={pageDesc}>
    <PhotoGallery images={posts.map(post => ({
      image: post.data.image,
      title: post.data.title,
      caption: post.data.caption,
      slug: post.slug
    }))} />
    <Pagination page={page} />
  </InteriorPage>
</Layout>
