---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import Button from '../../components/Button.astro';
import Layout from '../../layouts/Layout.astro';
import { SITE_SEO, BASE_URL, ROUTES } from '../../config/site';

export async function getStaticPaths() {
  const posts = await getCollection('gallery');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/*');

let optimizedImage;
if (post.data.image) {
  const imagePath = post.data.image.replace('/images/', '/src/assets/images/');
  if (images[imagePath]) {
    optimizedImage = (await images[imagePath]()).default;
  }
}
---

<Layout 
  title={`${post.data.title} | ${SITE_SEO.name.long}`} 
  description={post.data.caption ? post.data.caption : SITE_SEO.description}
>
  <div class="news-page">
    <div class="news-page-inner">
      <h1>{post.data.title}</h1>
      {post.data.caption && <p>{post.data.caption}</p>}
      {optimizedImage && (
        <Image 
          src={optimizedImage} 
          alt={post.data.title} 
          class="featured-image" 
          widths={[600, 900, 1200]}
          sizes="(max-width: 600px) 100vw, 600px"
        />
      )}
      <Button variant="secondary" href={BASE_URL + ROUTES.gallery}>Back to Photo Gallery</Button>
    </div>
  </div>
</Layout>

<style>
  img {
    inline-size: 100%;
    block-size: auto;
    margin-block-end: 2rem;
  }
  .news-page {
    background: var(--background-glow);
    height: 100%;
  }
  .news-page-inner {
    --padding-x: 2rem;
    container: news-page / inline-size;
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem var(--padding-x);
  }
  h1 {
    font-family: var(--ff-heading);
    font-size: clamp(1.8rem, 3.5vw, 3rem);
    font-weight: 700;
    line-height: 1.1;
    color: var(--paper);
    margin-bottom: 2rem;
  }
</style>
