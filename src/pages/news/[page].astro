---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import type { GetStaticPaths } from "astro";
import Layout from "../../layouts/Layout.astro";
import InteriorPage from "../../components/InteriorPage.astro";
import ArticleStub from "../../components/articles/ArticleStub.astro";
import Cards from "../../components/cards/Cards.astro";
import Card from "../../components/cards/Card.astro";
import { NEWS_PAGE_SIZE, SITE_SEO } from "../../config/site";
import Pagination from "../../components/articles/Pagination.astro";

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const posts = await getCollection("blog");
  const sortedPosts = posts.sort(
    (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  return paginate(sortedPosts, { pageSize: NEWS_PAGE_SIZE });
};

const { page } = Astro.props as {
  page: {
    data: CollectionEntry<"blog">[];
    currentPage: number;
    lastPage: number;
    url: {
      prev?: string | null;
      next?: string | null;
    };
  };
};
const posts = page.data;
---

<Layout title={`News & Updates | ${SITE_SEO.name.long}`} description="Latest news and updates from our dojo.">
  <InteriorPage heading="News & Updates">
    <Cards>
      {posts.map((post) => (
      <Card>
        <ArticleStub post={post} />
      </Card>
      ))}
    </Cards>
    <Pagination page={page} />
  </InteriorPage>
</Layout>
