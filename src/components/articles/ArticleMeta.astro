---
import { Icon } from 'astro-icon/components';
import type { Post } from "../../types";
import { BASE_URL, ROUTES, SITE_SEO } from '../../config/site';

const { post, isStub = false } = Astro.props as { post: Post, isStub?: boolean };
---

<header class="post-meta">
  <time datetime={post.data.pubDate.toISOString()}>
    {
      new Date(post.data.pubDate).toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      })
    }
  </time>
  {isStub ? (
    <>
      <h2>{post.data.title}</h2>
      {post.data.description && <p class="desc">{post.data.description}</p>}
    </>
  ) : (
    <div class="post-meta-full">
      <div>
        <h1>{post.data.title}</h1>
      </div>
      <div class="post-meta-full-info">
        <div>
          {post.data.author && <span class="author">By {post.data.author}</span>}
          {post.data.description && <p class="lead">{post.data.description}</p>}
        </div>
        <div>
          <button 
            class="d-none"
            type="button" 
            data-share="true"
            data-title={post.data.title}
            data-description={post.data.description}
            data-slug={post.slug}
          >
            <Icon name="share" /> Share
          </button>
        </div>
      </div>
    </div>
  )}
  {
    post.data.tags && (
      <div class="tags">
        {post.data.tags.map((tag) => (
          <span class="tag">{tag}</span>
        ))}
      </div>
    )
  }
  <slot></slot>
</header>

<script is:inline define:vars={{BASE_URL, ROUTES, SITE_SEO}}>
  const shareButton = document.querySelector('[data-share="true"]');

  shareButton?.classList.toggle('d-none', !navigator.share);
  document.addEventListener('click', (e) => {
    if (!navigator.share) return;
    if (e.target instanceof HTMLButtonElement && e.target.matches('[data-share="true"]')) {
      const title = `${shareButton.dataset.title} | ${SITE_SEO.name.short}`;
      const description = shareButton.dataset.description;
      const shareData = {
        title: title,
        text: description ? `${title}\n\n${description}` : title,
        url: `${BASE_URL}${ROUTES.gallery}${shareButton.dataset.slug}/`
      };
      navigator.share(shareData).catch((error) => {
        console.error('Error sharing:', error);
      });
    }
  });
</script>

<style>
  @layer components {
    :is(h1, h2) {
      font-family: var(--ff-heading);
      font-weight: 700;
      color: var(--paper);
      margin-block: 0.5em;
      line-height: 1.2;
    }
    h1 {
      font-size: clamp(2rem, 5vw, 3rem);
    }
    h2 {
      font-size: 1.25rem;
    }
    time {
      font-family: var(--ff-heading);
      font-size: 1rem;
      letter-spacing: 0.4em;
      text-transform: uppercase;
      color: var(--silver);
      margin-bottom: 1rem;
    }
    button {
      background: none;
      margin: 0;
      padding: 0;
      appearance: none;
      border: 0;
      font-family: var(--ff-heading);
      font-size: 1rem;
      color: var(--paper);
      text-decoration: underline;
      text-decoration-color: var(--bright-red);
      display: flex;
      align-items: center;
      gap: 0.35rem;
      cursor: pointer;
      margin-block-end: 1.5rem;
    }
    .post-meta-full-info {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 1rem;
      align-items: end;
    }
    .desc, .lead {
      line-height: 1.7;
      color: var(--cream);
      margin-bottom: 1.5rem;
    }
    .desc {
      font-size: 1rem;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 5;
      overflow: hidden;
    }
    .lead {
      font-size: 1.35rem;
    }
    .tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin: 1rem 0;
    }
    .tag {
      font-family: var(--ff-heading);
      background: var(--stone);
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.875rem;
    }
    .author {
      display: block;
      font-family: var(--ff-body);
      font-style: italic;
      font-size: 0.9rem;
      color: var(--cream);
      letter-spacing: 0.05em;
    }
  }
</style>
